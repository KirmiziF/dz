<!DOCTYPE html>
<html>
  <style>
    body, html{ margin: 0;}
  </style>
  <body>
  <script src="d3.js"></script>
  <script src="../dz.js"></script>
  <script>

var p = dz.projection.perspective()
  , w = window.innerWidth
  , h = window.innerHeight
  , svg = d3.select('body').append('svg')
  , max = Math.max(w, h), min = Math.min(w, h), diff = max - min
  , r = 40
  // screen scaling
  , screenX = d3.scale.linear().domain([-1, 1]).range([0, max])
  , screenY = d3.scale.linear().domain([-1, 1]).range([-diff/2, max + -diff/2])
  // 3D geometry!!
  , box = [
      [-1, -1, -1] // dot 0
    , [-1, -1,  1] // dot 1
    , [-1,  1, -1] // dot 2
    , [-1,  1,  1] // dot 3
    , [ 1, -1, -1] // dot 4
    , [ 1, -1,  1] // dot 5
    , [ 1,  1, -1] // dot 6
    , [ 1,  1,  1] // dot 7
  ]
  , lines = [
      [0, 4] // connect dots 0 and 4
    , [4, 5] // connect dots 4 and 5
    , [5, 1] // etc...
    , [5, 0]
  ]
  , line = d3.svg.line()
      .x(function(d){ return box })

function project(box, t){
  return box.map(function(p){ return p.slice(0)}) // deep copy
    .map(dz.matrix().rotateX(t).rotateZ(t).translate([0, 0, -10])
    .multiVector).map(p.project)
}


svg.selectAll('path').data(project(box, 0))
  .enter().append('circle').attr('fill', 'black')


svg.selectAll('path').data(lines)
  .enter().append('path').attr('d', function(d){ line(d) })

var circles = svg.selectAll('circle')
d3.timer(function(t){
  var t = t / 1000, f = 5 / t
  if(f < 0.5) f = 0.5
  f = 1
  p.camera().focalLength(f).position([0, 0, f / 1])
  circles.data(project(box, t))
    .sort(function(a, b){ return p.depth(a) - p.depth(b) })
    .attr('cx', function(d){ return screenX(d[0]) })
    .attr('cy', function(d){ return screenY(d[1]) })
    .attr('r', function(d){ return d[3] * r })
})

  </script>
  </body>
</html>