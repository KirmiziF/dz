<!DOCTYPE html>
<html>
  <style>
    body, html{ margin: 0;}
  </style>
  <body>
  <script src="d3.js"></script>
  <script src="../dz.js"></script>
  <script>

var p = dz.projection.perspective()
  , w = window.innerWidth
  , h = window.innerHeight
  , svg = d3.select('body').append('svg')
  , max = Math.max(w, h), min = Math.min(w, h), diff = max - min
  , r = 40
  // screen scaling
  , screenX = d3.scale.linear().domain([-1, 1]).range([0, max])
  , screenY = d3.scale.linear().domain([1, -1]).range([-diff/2, max + -diff/2])
  // 3D geometry!!
  , box = [
      [-1, -1, -1] // dot 0
    , [-1, -1,  1] // dot 1
    , [-1,  1, -1] // dot 2
    , [-1,  1,  1] // dot 3
    , [ 1, -1, -1] // dot 4
    , [ 1, -1,  1] // dot 5
    , [ 1,  1, -1] // dot 6
    , [ 1,  1,  1] // dot 7
  ]
  , lines = [
    // connect all the dots that have edges along the x axis
      [0, 4]
    , [1, 5]
    , [2, 6]
    , [3, 7]
    // connect all the dots that have edges along the y axis
    , [ 0, 2]
    , [ 1, 3]
    , [ 4, 6]
    , [ 5, 7]
    // connect all the dots that have edges along the z axis
    , [0, 1]
    , [2, 3]
    , [4, 5]
    , [6, 7]
  ] 
  // d3 line generator
  , line = d3.svg.line()
      .x(function(p){ return screenX(p[0])})
      .y(function(p){ return screenY(p[1])})


function project(box, t){
  return box.map(function(p){ return p.slice(0)}) // deep copy
    .map(dz.matrix().rotateX(t).rotateZ(t).translate([0, 0, 0])
    .multiVector).map(p.project)
}


svg.selectAll('path').data(project(box, 0))
  .enter().append('circle').attr('fill', 'black')


svg.selectAll('path').data(lines)
  .enter().append('path')

var circles = svg.selectAll('circle')
var path = svg.selectAll('path')
d3.timer(function(t){
  var t = t / 1000, f = 5 / t, data
  if(f < 0.5) f = 0.5
  p.camera().focalLength(0.3).position([0, 0, 4])
  flatBox = project(box, t)
  // connect the dots!
  path.data(lines.map(function(segment){
    var line = [flatBox[segment[0]], flatBox[segment[1]]]
    debugger
    return line
  })).attr('d', line).style('stroke', 'black').style('stroke-width','1')
  circles.data(flatBox)
    .sort(function(a, b){ return p.depth(a) - p.depth(b) })
    .attr('cx', function(d){ return screenX(d[0]) })
    .attr('cy', function(d){ return screenY(d[1]) })
    .attr('r', function(d){ return d[3] * r })
})

  </script>
  </body>
</html>