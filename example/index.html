<!DOCTYPE html>
<html>
  <style>
    body, html{ margin: 0;}
  </style>
  <body>
  <script src="d3.js"></script>
  <script src="../dz.js"></script>
  <script>

var p = dz.projection.perspective() //.x(x).y(y)
  , w = window.innerWidth
  , h = window.innerHeight
  , max = Math.max(w, h), min = Math.min(w, h), diff = max - min
  // screen scale
  , screenX = d3.scale.linear().domain([1, -1]).range([0, max])
  , screenY = d3.scale.linear().domain([-1, 1]).range([-diff/2, max + -diff/2])

var box = generateBox(5, 0.5).filter(function(p){
  return true
  // if(p[1] === 0 && p[2] === 0) return true // x axis
  // if(p[0] === 0 && p[2] === 0) return true // y axis
  // if(p[0] === 0 && p[1] === 0) return true // z axis
  // return false
})

function generateBox(n, width){
  var s = width / (n - 1), t = width / 2
  var points = []
  for(var x = 0; x < n; x++){
    for(var y = 0; y < n; y++){
      for(var z = 0; z < n; z++){
        points.push([x * s - t, y * s - t, z * s - t])
      }
    }
  }
  return points
}

var svg = d3.select('body').append('svg')
  , theta = 0
  , rotate = dz.rotate
  , translate = dz.translate
  , matrix = dz.matrix
  , scale = dz.scale
  , t = 100
  , x = 0
  , y = 0
  , z = 0
  , s = 5
  , f = 1
  , r = 20

p.camera().position([0, 0, 40]).lookAt([0, 0, 0]).focalLength(f)

function transform(box){
  data = box.map(function(p){ return p.slice(0) }) // copy points
  data = scale(data,[s, s, s])
  data = data.map(matrix().rotateX(t).multiVector)
  data = data.map(matrix().rotateY(t).multiVector)
  data = data.map(matrix().rotateZ(t).multiVector)
  data = translate(data, [x, y, z])
  return data
}

svg.selectAll('circle').data(transform(box))
  .enter().append('circle')
  .attr('fill', function(d, i){
    d = box[i] // get original coords
    // origin
    if(d[0] === 0 && d[1] === 0 && d[2] === 0) return 'purple'
    // x axis
    if(d[0] > 0 && d[1] === 0 && d[2] === 0) return 'red'
    // y axis
    if(d[0] === 0 && d[1] > 0 && d[2] === 0) return 'green'
    // z axis
    if(d[0] === 0 && d[1] === 0 && d[2] > 0) return 'blue'
    return 'rgba(0,0,0,0.1)'
  })

var circles = svg.selectAll('circle')
d3.timer(function(t){
  t = t / 1000
  p.camera().focalLength(t).position([0, 0, t])
  var data = transform(box)
  circles.data(data).sort(function(a, b){ return p.depth(a) - p.depth(b) })
    .attr('cx', function(d){ return screenX(p.x(d)) })
    .attr('cy', function(d){ return screenY(p.y(d)) })
    .attr('r', function(d){ 
      return p.scale(d) * r
    })
})

  </script>
  </body>
</html>