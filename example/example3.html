<!DOCTYPE html>
<html>
  <style>
    body, html{ margin: 0;}
  </style>
  <body>
  <script src="d3.js"></script>
  <script src="../d33d.js"></script>
  <script>

var p = d33d.projection.perspective() //.x(x).y(y)
  , w = window.innerWidth
  , h = window.innerHeight
  , max = Math.max(w, h), min = Math.min(w, h), diff = max - min
  // screen scale
  , screenX = d3.scale.linear().domain([1, -1]).range([0, max])
  , screenY = d3.scale.linear().domain([-1, 1]).range([-diff/2, max + -diff/2])

var box = generateBox(7, 0.5)

function generateBox(n, width){
  var s = width / (n - 1), t = width / 2
  var points = []
  for(var x = 0; x < n; x++){
    for(var y = 0; y < n; y++){
      for(var z = 0; z < n; z++){
        points.push([x * s - t, y * s - t, z * s - t])
      }
    }
  }
  return points
}

var svg = d3.select('body').append('svg')
  , theta = 0
  , x = 0
  , y = 0
  , z = 0
  , s = 1
  , f = 1
  , r = 20

p.camera().lookAt([0, 0, 0]).focalLength(f)

function transform(box, t){
  data = box.map(function(p){ return p.slice(0) }) // copy points
  data = d33d.scale(data,[s, s, s])
  data = data.map(d33d.matrix().rotateX(t).multiVector)
  data = data.map(d33d.matrix().rotateY(t).multiVector)
  data = data.map(d33d.matrix().rotateZ(t).multiVector)
  data = d33d.translate(data, [x, y, z])
  return data
}

svg.selectAll('circle').data(transform(box, 0))
  .enter().append('circle')
  // color the circles according to the axis
  .attr('fill', function(d, i){
    d = box[i] // get original coords
    // origin
    if(d[0] === 0 && d[1] === 0 && d[2] === 0) return 'purple'
    // x axis
    if(d[0] > 0 && d[1] === 0 && d[2] === 0) return 'red'
    // y axis
    if(d[0] === 0 && d[1] > 0 && d[2] === 0) return 'green'
    // z axis
    if(d[0] === 0 && d[1] === 0 && d[2] > 0) return 'blue'
    return 'rgba(0,0,0,0.1)'
  })

var circles = svg.selectAll('circle')
d3.timer(function(t){
  var t = t / 10000
    , data = transform(box, t)
    , end = 100, f = end - t
  if(f < 1) f = 1
  p.camera().focalLength(f).position([0, 0, 100])
  circles.data(data).sort(function(a, b){ return p.depth(a) - p.depth(b) })
    .attr('cx', function(d){ return screenX(p.x(d)) })
    .attr('cy', function(d){ return screenY(p.y(d)) })
    .attr('r', function(d){ 
      return p.scale(d) * r
    })
})

  </script>
  </body>
</html>